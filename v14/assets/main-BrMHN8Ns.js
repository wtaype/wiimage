import{o as U,g as A,a as L,$ as e,s as C,b as d,r as h,c as R,d as B,e as F}from"./widev-BfmvTXIU.js";import"./wiauth-Cx-2vr4f.js";U(F,async t=>{if(!t)return h("wiAuthIn"),h("wiAuthRol"),SmilePublico();if(d("wiAuthIn")){const a=d("wiAuthRol");if(a)return accederRol(a);const n=await getDocs(query(collection(B,"smiles"),where("email","==",t.email)));accederRol(n.docs[0]?.data()?.rol)}});A(".txe","id",t=>t.html());L(".txe","id",(t,a)=>t.html(a));const i=e(".txe"),G=e(".nts"),r=e(".editor .hcon");let m=0;const w=t=>+String(t).replace(/\D+/g,"")||0,E=(t,a=28)=>e("<div>").html(t||"").text().replace(/\s+/g," ").trim().slice(0,a),K=t=>(e('[data-ki^="ki"]').removeClass("activa"),e(`[data-ki="${t}"]`).addClass("activa")),$=(t,a)=>{const n=e(`[data-ki="${t}"]`);n.length?n.text(a):e(`<div class="nt nt${w(t)}" data-ki="${t}">${a}</div>`).appendTo(G)},T=t=>{const a=d(t)||"";i.attr("id",t).html(a).focus(),K(t)},P=()=>{const t=e('[data-ki^="ki"]').map((n,l)=>w(e(l).data("ki"))).get(),a=Object.keys(localStorage).filter(n=>/^ki\d+$/.test(n));m=Math.max(m,0,...t,...a.map(w)),e.each(a,(n,l)=>{const S=d(l);S&&$(l,E(S)+"...")})},q=(()=>{let t;return(a=1800)=>{const n=e(".guardar_nota");n.length&&(n.addClass("bta").text("Guardado"),clearTimeout(t),t=setTimeout(()=>{n.removeClass("bta").text("Guardar")},a))}})();i.on("input",()=>{const t=i.attr("id");if(t){C(t,i.html(),24);const a=E(d(t));a&&e(`[data-ki="${t}"]`).text(a+"..."),q()}});e(document).on("click",".guardar_nota",()=>{const t=i.attr("id");t&&(C(t,i.html(),24),q())});P();e(document).on("click",".agregar_nota",()=>{const t=`ki${++m}`;$(t,`Nota ${m}`),T(t)});e(document).on("click",'[data-ki^="ki"]',t=>T(e(t.currentTarget).data("ki")));e(document).on("click",".limpiar_nota",()=>{const t=i.attr("id");t&&(i.empty(),h(t),$(t,"Nota vacía..."),R(void 0,"bta","Eliminado","Eliminar"))});const z={".fa-bold":"bold",".fa-italic":"italic",".fa-underline":"underline",".fa-list-ul":"insertUnorderedList",".fa-list-ol":"insertOrderedList",".fa-align-left":"justifyLeft",".fa-align-center":"justifyCenter",".fa-align-right":"justifyRight",".fa-rotate-left":"undo"};e.each(z,(t,a)=>r.find(t).attr("data-cmd",a));let k=null;const x=()=>{const t=window.getSelection();if(!t||!t.rangeCount)return!1;const a=t.anchorNode;return a&&(i[0]===a||e.contains(i[0],a))},v=()=>{const t=window.getSelection();t&&t.rangeCount&&x()&&(k=t.getRangeAt(0))},H=()=>{if(!k)return;const t=window.getSelection();t.removeAllRanges(),t.addRange(k)},J=t=>{!x()&&k&&H(),document.execCommand(t,!1,null),i.focus(),v(),p()};r.on("mousedown","i",t=>t.preventDefault()).on("click","i",function(){const t=e(this).data("cmd");t&&J(t)});const Q=[[".fa-bold","bold"],[".fa-italic","italic"],[".fa-underline","underline"],[".fa-list-ul","insertUnorderedList"],[".fa-list-ol","insertOrderedList"]],p=()=>{if(!x())return void r.find("i").removeClass("actv").addClass("is-disabled");r.find("i").removeClass("is-disabled"),e.each(Q,(n,l)=>r.find(l[0]).toggleClass("actv",document.queryCommandState(l[1])));const t=document.queryCommandState("justifyCenter"),a=document.queryCommandState("justifyRight");r.find(".fa-align-center").toggleClass("actv",t),r.find(".fa-align-right").toggleClass("actv",a),r.find(".fa-align-left").toggleClass("actv",!t&&!a)};document.addEventListener("selectionchange",()=>{v(),p()});i.on("keyup mouseup input",()=>{v(),p()});v();p();const D=e(".paste"),o=e(".ibx .bx");o.each((t,a)=>e(a).attr("data-k",`im${t+1}`));const y=e(".vw"),_=e(".vw img"),s=e(".vw .th");let c=-1;const b=()=>o.map((t,a)=>e(a).attr("data-src")?t:null).get(),u=()=>{const t=b();s.empty().append(t.map(a=>`<div class="ti" data-i="${a}"><img src="${o.eq(a).attr("data-src")}"></div>`)),s.find(`[data-i="${c}"]`).addClass("on")},V=(t,a)=>{const n=o.eq(t);n.attr("data-src",a).addClass("fill").html(`<img src="${a}">`),C(n.attr("data-k"),a,720),u()},W=()=>o.toArray().findIndex(t=>!e(t).attr("data-src")),X=t=>{let a=W();a<0&&(a=0),V(a,t)},Y=t=>{const a=new FileReader;a.onload=()=>X(a.result),a.readAsDataURL(t)},j=t=>Array.from(t).forEach(a=>a&&/^image\//.test(a.type)&&Y(a));D.on("paste",t=>{const a=t.originalEvent.clipboardData;a&&j(Array.from(a.items).map(n=>n.getAsFile()).filter(Boolean))});D.on("dblclick",()=>{e('<input type="file" accept="image/*" multiple hidden>').appendTo("body").on("change",t=>{j(t.target.files),e(t.target).remove()}).trigger("click")});L(".ibx .bx","data-k",(t,a)=>{a&&t.attr("data-src",a).addClass("fill").html(`<img src="${a}">`)});A(".ibx .bx","data-k",t=>t.attr("data-src")||"");u();const f=t=>{const a=o.eq(t).attr("data-src");if(!a)return;c=t,_.attr("src",a),y.addClass("show"),s.find(".ti").removeClass("on"),s.find(`[data-i="${t}"]`).addClass("on");const n=s.find(`[data-i="${t}"]`);n.length&&s.animate({scrollLeft:Math.max(0,n.position().left+s.scrollLeft()-(s.width()-n.width())/2)},180)},g=()=>{y.removeClass("show"),c=-1},O=()=>{const t=b();if(!t.length)return g();f(t[(t.indexOf(c)+1)%t.length])},I=()=>{const t=b();if(!t.length)return g();f(t[(t.indexOf(c)-1+t.length)%t.length])},M=()=>{const t=e("<a>").attr({href:_.attr("src"),download:`wiimage-${c+1}.png`}).appendTo("body");t[0].click(),t.remove()},N=()=>{const t=o.eq(c);h(t.attr("data-k")),t.removeAttr("data-src").removeClass("fill").empty(),u();const a=b();a.length?f(a[0]):g()};e(document).on("click",".ibx .bx",t=>{const a=o.index(t.currentTarget);e(t.currentTarget).attr("data-src")&&f(a)});e(document).on("click",".vw .cls, .vw",t=>{(t.target===t.currentTarget||e(t.target).closest(".cls").length)&&g()});e(document).on("click",".vw .nx",O);e(document).on("click",".vw .pv",I);e(document).on("click",".vw .dl",M);e(document).on("click",".vw .rm",N);e(document).on("click",".vw .th .ti",t=>f(+e(t.currentTarget).data("i")));e(document).on("keydown",t=>{if(y.hasClass("show")){if(t.ctrlKey&&(t.key==="s"||t.key==="S"))return t.preventDefault(),M();if(t.key==="Escape")return g();if(t.key==="ArrowRight"||t.key===">"||t.key===".")return O();if(t.key==="ArrowLeft"||t.key==="<"||t.key===",")return I();if(t.key==="Delete"||t.key==="Supr"||t.key==="Backspace")return N()}});e(".bt_borrar").click(function(){if(confirm("¿Eliminar todo lo guardado?")){try{localStorage.clear()}catch{Object.keys(localStorage).forEach(a=>localStorage.removeItem(a))}e('[data-ki^="ki"]').remove(),i.removeAttr("id").empty(),m=0,o.removeAttr("data-src").removeClass("fill").empty(),u&&u(),y.removeClass("show"),c=-1,R(this,"bta","Eliminado","Eliminar")}});
